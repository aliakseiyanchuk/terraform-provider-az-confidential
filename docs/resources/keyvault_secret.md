---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "az-confidential_keyvault_secret Resource - az-confidential"
subcategory: ""
description: |-
  Creates a version of a secret in the destination key vault from the
  provided ciphertext and additional parameters supplied as
  resource attributes.
  How to create the ciphertext
  The ciphertext (i.e. the value of the content attribute) can be created with the encrypt_keyvault_secret function.
  This function will generate only the ciphertext. A complimentary tfgen https://github.com/aliakseiyanchuk/terraform-provider-az-confidential-tfgen
  tool can used to generate both ciphertext
  and the Terraform code template.
  As a pre-requisite, you need to have a public key of the key-encryption key the action provider instance will
  be using.
  Example how to create ciphertext using Terraform provider
  Consider the following example that creates a ciphertext that can be used for test and acceptance purposes for
  next year when the content should not be read more than 50 times:
  
  locals {
    public_key = file(var.public_key_file)
  }
  
  output "encrypted_keyvault_secret" {
    value = provider::az-confidential::encrypt_keyvault_secret(
      "this is a secret value",
      {
        vault_name = "vaultname123",
        name       = "keyName123",
      },
      {
        create_limit  = "72h"
        expires_after = 365
        num_uses      = 50
        provider_constraints = toset(["test", "acceptance"])
      },
      local.public_key
    )
  }
  
  
  Please refer to the encrypt_keyvault_secret function documentation ../functions/encrypt_keyvault_secret.md
  for the description of the parameters the function accepts.
  Create ciphertext using tfgen tool
  The ciphertext as well as a complete Terraform datasource template can be obtained using the tfgen command-line tool
  (see source code https://github.com/aliakseiyanchuk/terraform-provider-az-confidential-tfgen.)
  The prompt equivalent to the function invocation illustrated above is:
  
  tfgen -pubkey [path to the public key] \
    -provider-constraints demo,acceptance \
    -num-uses 50 \
    keyvault secret
  
  The tool will prompt for the interactive content input. Further options can be obtained by tfgen -help and
  tfgen keyvault secret -help commands.
---

# az-confidential_keyvault_secret (Resource)

Creates a version of a secret in the destination key vault from the
provided ciphertext and additional parameters supplied as
resource attributes.

# How to create the ciphertext
The ciphertext (i.e. the value of the `content` attribute) can be created with the `encrypt_keyvault_secret` function.
This function will generate only the ciphertext. A complimentary [`tfgen`](https://github.com/aliakseiyanchuk/terraform-provider-az-confidential-tfgen)
tool can used to generate both ciphertext
and the Terraform code template.

As a pre-requisite, you need to have a public key of the key-encryption key the action provider instance will
be using.

### Example how to create ciphertext using Terraform provider

Consider the following example that creates a ciphertext that can be used for test and acceptance purposes for
next year when the content should not be read more than 50 times:

```terraform
locals {
  public_key = file(var.public_key_file)
}

output "encrypted_keyvault_secret" {
  value = provider::az-confidential::encrypt_keyvault_secret(
    "this is a secret value",
    {
      vault_name = "vaultname123",
      name       = "keyName123",
    },
    {
      create_limit  = "72h"
      expires_after = 365
      num_uses      = 50
      provider_constraints = toset(["test", "acceptance"])
    },
    local.public_key
  )
}

```

Please refer to the [`encrypt_keyvault_secret` function documentation](../functions/encrypt_keyvault_secret.md)
for the description of the parameters the function accepts.

### Create ciphertext using `tfgen` tool

The ciphertext as well as a complete Terraform datasource template can be obtained using the `tfgen` command-line tool
(see [source code](https://github.com/aliakseiyanchuk/terraform-provider-az-confidential-tfgen).)
The prompt equivalent to the function invocation illustrated above is:
```shell
tfgen -pubkey [path to the public key] \
  -provider-constraints demo,acceptance \
  -num-uses 50 \
  keyvault secret
```
The tool will prompt for the interactive content input. Further options can be obtained by `tfgen -help` and
`tfgen keyvault secret -help` commands.

## Example Usage

```terraform
# ----------------------------------------------------------------------------
#
# Azure KeyVault Secret
#
# The resource creates a secret version in the specified Key Vault service.
# Secret version in Key Vault are immutable, their value cannot be changed
# after these were created. To update a secret, create a new version
# and delete the one previously created.
# ----------------------------------------------------------------------------

resource "az-confidential_keyvault_secret" "secret" {
  content = <<-CIPHERTEXT
       H4sIAAAAAAAA/1TTyZKqSACF4T1P4Z7uYBazInqBiBTIoJgy7RASTIZkygLx6Tvq7u6Js/r2/7+/Oxqm
       5e1034OGB/8Io08oo8jBHaZfO0FVFF6QRIVnjPeAp+2XDnsR8LzCM25foDZAJZoQydHXLu8nxM10wqTi
       FoG5tlmOOkSo3pOZThkmdP7aMdepX3CBpr+0QF3/D0UzxaRi4Dagr12zcDPKJ0QZxtPd/hnZ8/edVObN
       D/itO7JXbttnn+vbvTf2XomsQisVbFRgzV+SpsFh4DTN5V/wMrkMebDHvT+ocnnLG8C9QQQEDWh7/6b7
       rcF6VTCy47pVaFw8eCws0MfrsHdwm+RjEPgmcw79932AE/dap/gcsyjlrZJaochaTp3Vz013YdKeIzYL
       PVr39+8qw79XThfVDB4rY8s9dQAom0w3YaRaZnTpQsCGWtE7Hi8AWD6K9FKQKn2PJ5h8MrQMef5Jm6vd
       dVhoGNFJ2u1ceT78WaCoDPdoEip4A9b9+3NJ3W/g4BmPokfyrRttjqxQwh59znWmA7zqKnPlME54CxUP
       a2naALAkpGuftLxZs7Gy8oJQyPpIkmcRlbNZNs3Pdea0jo55/FgrkWfMYwWflqyUoRnjOmmMUDrEoL9U
       QPn0KtZrHHJiZURhfoteJzZ6J4KgRdns195n2XTINFzTqzdVwD/Pgz+4m5iSPqpC54W14G7LaWW552M+
       8nF4YD/aa4l1ftRy6nfu+6PeTgtjBHCE4DDq2+GyOvhs0ET7OGmtaJbYOJIiE2IfU2xcRTlBLX3dTdUL
       pbZpXOi+XvOJwdcCFHa1xQ/XaVonBOz9EiT+SddkXctp5tiGQ55tIpkXqQdLvP2UZa0oBkw5gXQ5Ydre
       hfYNmhmfG5rUB6iQJ2mR6+xUKsCuZI1jgUyW3D0d/mP+BGV4p78D+z8AAP//IsFRdHkDAAA=
       CIPHERTEXT

  # This secret is enabled for operation. Optionally, there is an option
  # to temporarily disable it.
  enabled = true

  # If the secret version should nto used before a specific date,
  # it needs to be formatted yyyy-mm-ddTHH:MM:SS'Z'
  # not_before_date = "2025-08-09T15:40:50Z"

  # If the secret version cannot be used after this date
  # it needs to be formatted yyyy-mm-dd'T'HH:MM:SS'Z'
  # not_after_date = "2026-08-09T15:40:50Z"

  tags = {
    # Fill the tags as desired
    # tagName = "TagValue"
  }

  destination_secret = {
    vault_name = "demo-vault"
    name = "demo"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `content` (String) Encrypted confidential content to create this resource
- `destination_secret` (Attributes) Specification of a vault where this secret needs to be stored (see [below for nested schema](#nestedatt--destination_secret))

### Optional

- `content_type` (String) Content type of the secret, if required
- `enabled` (Boolean) Whether the version is enabled or not
- `not_after_date` (String) Secret not usable before the provided UTC datetime (Y-m-d'T'H:M:S'Z')
- `not_before_date` (String) Secret not usable before the provided UTC datetime (Y-m-d'T'H:M:S'Z')
- `tags` (Map of String) Set of tags to be assigned to this secret
- `wrapping_key` (Attributes) Wrapping key to use for key and secret unwrapping purposes (see [below for nested schema](#nestedatt--wrapping_key))

### Read-Only

- `id` (String) Identifier of the decryption operation
- `secret_version` (String) Version of the secret created in the target vault

<a id="nestedatt--destination_secret"></a>
### Nested Schema for `destination_secret`

Required:

- `name` (String) Name of the secret to store

Optional:

- `vault_name` (String) Vault where the secret needs to be stored. If omitted, defaults to the vault containing the wrapping key


<a id="nestedatt--wrapping_key"></a>
### Nested Schema for `wrapping_key`

Optional:

- `algorithm` (String) Algorithm to use for unwrapping secret/content encryption key; defaults to RSA OAEP 256; a sensible default that doesn't need to be changed
- `name` (String) Name of the wrapping key
- `vault_name` (String) Vault name containing the wrapping key
- `version` (String) Version of the wrapping key to use for unwrapping operations
